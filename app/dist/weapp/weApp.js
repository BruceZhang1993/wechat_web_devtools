"use strict";function init(){var e=global.appConfig.isDev,r=require("../config/config.js"),s=r.JSON_PARSE_ERROR,i=r.ES6_ERROR,t=r.JSON_FILE_ERROR,p=r.JSON_ENTRANCE_ERROR,n=r.JSON_CONTENT_ERROR,a=require("./trans/transManager.js"),o=require("./utils/tools.js"),c=(require("async"),require("fs")),u=require("path"),l=require("url"),f=(require("querystring"),require("./utils/vendorManager.js")),g=(require("glob"),require("./utils/projectManager.js")),h=require("../config/appserviceConfig.js"),j=require("../stores/projectStores.js"),v=require("../stores/windowStores.js"),d=require("../actions/windowActions.js"),_=require("./utils/parseErr.js"),q=require("../utils/file.js"),R=require("../config/weappConfig.js"),E=R.default_scene,m=(require("./tpl/errorTpl.js"),require("./tpl/appserviceErrorTpl.js"),u.join(__dirname,"appservice/asdebug.js")),w=c.readFileSync(m,"utf8");o.noBrowser.join(",");_exports.getAppservice=function(r,a){var q=o.getProject(r),R=l.parse(r),m=R.pathname,S=/appservice$/.test(m),C=/appservice-sdk\.js$/.test(m),P=/asdebug\.js$/.test(m),x=/ascheck\.js$/.test(m),y=/webnode\.js$/.test(m),N=/reporter-sdk\.js/.test(m),F=/app_service_engine\.js/.test(m),O=(/\.js$/.test(m),/\.js\.map$/.test(m)),J=/WAService\.js/.test(m),T=/favicon\.ico$/.test(m);if(T)a(200,{},"");else if(J)a(null,{},f.getFile("WAService.js",q.libVersion));else if(N)a(null,{},f.getFile("reporter-sdk.js"));else if(F)a(null,{},f.getFile("app_service_engine.js"));else if(C)a(null,{},f.getFile("appservice-sdk.js"));else if(P)a(null,{},w);else if(x)a(null,{},asCheck);else if(y)a(null,{},f.getFile("webnode.js"));else if(O){var k=u.join(q.projectpath,m);c.readFile(k,function(e,r){return e?void a(404,{},"do not find "+k):void a(200,{},r)})}else{var I=(q.appname.toLowerCase(),q.appid.toLowerCase(),q.hash),b=void 0;try{b=g.getAppConfigJSONSync(q)}catch(e){return a(200,{},""),void setTimeout(function(){var r=e.type,i=void 0;r===s?i=_.parseJsonParseErr(e):r===t?i=_.parseJsonFileErr(e):r===p?i=_.parseJsonEntranceErr(e):r===n&&(i=_.parseJsonContentErr(e)),d.showWeappError(e.type,i)},200)}var A=j.getProjectConfig(q);b.projectConfig=A,b.appserviceConfig=h;var $=b.pages||[];if(S){var W=require("./tpl/appserviceTpl.js"),D="http://"+I+".appservice.open.weixin.qq.com/",L=[],B=[],M=[];g.getAllJSFileList(q,function(r,s){for(var i={},t=0,p=$.length;t<p;t++){var n=$[t]+".js";i[n]=!0,L.push("<script>__wxRoute = '"+$[t]+"';__wxRouteBegin = true</script>"),L.push('<script src="'+D+n+'"></script>'),L.push('<script>\n              if(__wxRouteBegin) {\n                console.group("'+new Date+' page 编译错误")\n                console.error(` '+$[t]+" 出现脚本错误或者未正确调用 Page()`)\n                console.groupEnd()\n              }\n              </script>")}for(var o=0,c=s.length;o<c;o++){var u=s[o];i[u]||("app.js"===u?M.push('<script src="'+D+u+'"></script>'):B.push('<script src="'+D+u+'"></script>'))}L=B.concat(M).concat(L),e?(L.unshift('<script src="'+D+'app_service_engine.js"></script>'),L.unshift('<script src="'+D+'appservice-sdk.js"></script>'),L.unshift('<script src="'+D+'reporter-sdk.js"></script>'),L.unshift('<script src="'+D+'webnode.js"></script>')):L.unshift('<script src="'+D+'WAService.js"></script>'),L.unshift('<script src="'+D+'asdebug.js"></script>'),b.appname=q.appname,b.app_nickname=q.app_nickname||q.appname,b.appid=q.appid,b.apphash=q.hash,b.isTourist=q.isTourist,b.platform="devtools",q.isTourist&&(b.userInfo=v.getUserInfo()),b.urlCheck=q.urlCheck;var l,f,g=b.entryPagePath.replace(/\.html$/,""),h={},j=E;if(q.initPath.enable){g=q.initPath.page||g;var d=(q.initPath.query||"").split("&");d.forEach(function(e){var r=e.split("=");r[0]&&(h[r[0]]=r[1])}),j=q.initPath.scene||E,q.initPath.appid&&(l.appId=q.initPath.appid);var _={};if(q.initPath.referData){try{_=JSON.parse(q.initPath.referData)}catch(e){L.push('<script>\n                  if(__wxRouteBegin) {\n                    console.group("'+new Date+' referrerInfo.data 编译错误")\n                    console.error(` 请确认编译条件中的启动数据设置是否正确`)\n                    console.groupEnd()\n                  }\n                  </script>'),_={}}l.extraData=_}f={};var R=q.initPath.groupInfo;R&&(f.shareKey=R.shareKey||"",f.shareName=R.shareName||"")}b.appLaunchInfo={referrerInfo:l,shareInfo:f,path:g,scene:parseInt(j),query:h},L.unshift("<script>var __wxConfig = "+JSON.stringify(b)+"</script>"),W=W.replace("<script></script>",L.join("")),a(null,{},W)})}else{var U=r.replace("http://"+I+".appservice.open.weixin.qq.com/","");g.getScripts({project:q,fileName:U,needRequire:"app.js"===U||$.indexOf(U.replace(/\.js/,""))!==-1},function(e,r){e?r?(d.showWeappError(i,{file:e.sourceFileName,msg:e.msg}),a(200,{},"")):(e.project=q,d.showWeappError(e.type,_.parseJsFileErr(e)),a(200,{},"")):a(null,{"Content-Type":"text/javascript; charset=UTF-8"},r)})}}},_exports.getLocalIdResponse=function(e,r){if(q.isAppTmpPath(e)){var s=q.getRealPath(e);c.readFile(s,function(e,s){e?r(404,{"Weapp-Error":encodeURIComponent(e)},e.toString()):r(null,{},s)})}else r(404,{},"do not find "+e)},_exports.getResponse=function(e,r){a.getResponse(e,r)}}var _exports={};init(),module.exports=_exports;