"use strict";var _exports;function init(){const a="darwin"===process.platform,b=global.appConfig.isDev,c=require("fs"),d=require("path"),f=require("../utils/tools.js"),g=require("glob"),h=require("async"),j=require("../../config/dirConfig.js"),k=j.WeappVendor,l=require("mkdir-p"),m=require("./initAppConfig.js"),n=require("./initAppServiceJs.js");require("child_process").spawn;const o=require("../../common/log/log.js"),p=require("babel-core"),q=require("autoprefixer"),r=require("postcss"),s=b?d.join(__dirname,"../vendor/"):k;a?d.join(s,"wcc"):d.join(s,"wcc.exe");const t=["iOS >= 8","Chrome >= 37"];let u=j.Weappdest;const v=f.whiteFileExtName;_exports=(w,x,y)=>{w.projectpath;let z=w.es6,A=w.minified,B=w.postcss,C=d.join(u,`${+new Date}`);l.sync(C);let D={};D.appconfig=E=>{m(w,x,(F,G)=>{E(F,G)})},D.appservicejs=E=>{n(w,x,(F,G)=>{E(F,G)})},h.parallel(D,(E,F)=>{return E?void y(E.toString()):void g("./**",{nodir:!0,cwd:w.projectpath,ignore:["./node_modules/**/*"]},(G,H)=>{for(let I=0;I<H.length;I++){let J=H[I],K=d.extname(J);if(!v[K])o.info(`build.js find file not in whiteList ${J}`);else{let L=d.join(C,J),M=d.dirname(L);if(l.sync(M),z&&".js"===K){let N=c.readFileSync(d.join(w.projectpath,J),"utf8");try{let O=p.transform(N,{presets:["es2015"],babelrc:!1,minified:A,comments:!A});c.writeFileSync(L,O.code)}catch(O){return void y(`${J} - ${O}`)}}else if(B&&".wxss"===K){let N=c.readFileSync(d.join(w.projectpath,J),"utf8");try{let O=r([q({browsers:t})]).process(N).css;c.writeFileSync(L,O,"utf8")}catch(O){return void y(O)}}else{let N=c.readFileSync(d.join(w.projectpath,J));c.writeFileSync(L,N)}}}y(null,C)})})}}init(),module.exports=_exports;