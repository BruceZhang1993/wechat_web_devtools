"use strict";function init(){var t=require("../lib/react.js"),e=require("../actions/windowActions.js"),s=require("../stores/windowStores.js"),i=require("../stores/webviewStores.js"),o=require("../stores/projectStores.js"),r=(require("../actions/projectActions.js"),require("../common/log/log.js")),n=require("./setting/setting.js"),a=require("./lunch/lunch.js"),u=require("./create/create.js"),c=require("./confirm/confirm.js"),h=require("./toast/toast.js"),l=require("./custompre/custompreview.js"),m=require("./custompre/widgetCustom.js"),p=require("./custompre/searchcustom.js"),g=require("./Main.js"),v=require("../utils/newReport.js"),_=require("../config/config.js"),f=_.SELECT_URL_TYPE,L=_.SELECT_UNKNOW_TYPE,S=function(t){e.showTipsMsg({msg:t,type:"error"})},j=global.Win,d=void 0,w=void 0,T=void 0,x=void 0,E={editor:1,proxy:2,notify:3},W=t.createClass({displayName:"ContainController",getInitialState:function(){var t=!!Object.keys(s.getUserInfo()).length,i=o.getLastSelect(),r=i===f,n="",a=!1;if(i!==f&&i!==L){n=i;var u=s.getEditorConfig("autoRefresh");void 0===u&&e.updateEditorConfig({autoRefresh:n.watcher})}var c=s.getLastWinStatus()||{};return{hasLogin:t,commonUrl:r,project:n,type:i,showSetting:a,lastWinStatus:c,cursorLoading:!1}},componentDidMount:function(){this.state.hasLogin&&(this.state.project||this.state.commonUrl)&&this.appToMax(),s.on("UPDATA_USER_INFO",this._upDataUserInfo),i.on("NOT_LOGIN",this.goToLogin),i.on("INVALID_LOGIN",this.goToLogin),o.on("CLOSE_PROJECT",this._closeProject),o.on("DEL_PROJECT",this._delProject),s.on("SHOW_SETTING",this._showSetting),j.on("maximize",this._maximize),j.on("restore",this._restore),j.on("enter-fullscreen",this._enterFullscreen),j.on("resize",this._resize),j.on("move",this._move)},componentWillUnmount:function(){s.removeListener("UPDATA_USER_INFO",this._upDataUserInfo),i.removeListener("NOT_LOGIN",this.goToLogin),i.removeListener("INVALID_LOGIN",this.goToLogin),o.removeListener("CLOSE_PROJECT",this._closeProject),o.removeListener("DEL_PROJECT",this._delProject),s.removeListener("SHOW_SETTING",this._showSetting),j.removeListener("maximize",this._maximize),j.removeListener("restore",this._restore),j.removeListener("enter-fullscreen",this._enterFullscreen),j.removeListener("resize",this._resize),j.removeListener("move",this._move)},setLastWinStatus:function(t){this.setState({lastWinStatus:t}),(this.state.commonUrl||this.state.project)&&s.setLastWinStatus(t)},restore:function(t){var e=this,i=j.isFullscreen;clearTimeout(T),clearTimeout(x);var o=function o(){if(j.removeListener("move",e._move),j.removeListener("resize",e._resize),j.removeListener("restore",e._restore),"init"===t)j.resizeTo(nw.App.manifest.window.width,nw.App.manifest.window.height),setTimeout(function(){j.setPosition("center"),setTimeout(function(){j.on("resize",e._resize),j.on("move",e._move),j.on("restore",e._restore)},300)},500);else{var r=s.getLastWinStatus();r.isFullscreen=!1,r.status="restore";var n=void 0===r.x?100:r.x,a=void 0===r.y?100:r.y;n=n<-300?0:n,a=a<-300?0:a,j.moveTo(n,a);var u=void 0===r.width?nw.App.manifest.window.width:r.width,c=void 0===r.height?nw.App.manifest.window.height:r.height;j.resizeTo(u,c),e.setLastWinStatus(r),setTimeout(function(){j.on("resize",e._resize),j.on("move",e._move),j.on("restore",e._restore)},300)}i&&j.removeListener("restore",o)};i?(j.on("restore",o),j.leaveFullscreen()):o()},_move:function(){var t=this;clearTimeout(x),x=setTimeout(function(){var e=Object.assign({},t.state.lastWinStatus);e.x=j.x,e.y=j.y,t.setLastWinStatus(e)},500)},_resize:function(){var t=this;clearTimeout(T),T=setTimeout(function(){var e=Object.assign({},t.state.lastWinStatus);e.width=j.width,e.height=j.height,t.setLastWinStatus(e)},500)},_enterFullscreen:function(){var t=Object.assign({},this.state.lastWinStatus);t.isFullscreen=!0,this.setLastWinStatus(t)},_maximize:function(){clearTimeout(T),clearTimeout(x);var t=Object.assign({},this.state.lastWinStatus);t.status="max",d=j.height,w=j.width,this.setLastWinStatus(t)},_restore:function(){var t=Object.assign({},this.state.lastWinStatus);t.status="restore",t.isFullscreen=!1,j.width===w&&j.height===d&&(t.status="max"),this.setLastWinStatus(t)},_upDataUserInfo:function(t){var e=this,s=!!Object.keys(t).length;s?(this.setState({hasLogin:!0}),(this.state.project||this.state.commonUrl)&&this.appToMax()):setTimeout(function(){e.goToLogin()},50)},_delProject:function(){this.setState({project:"",commonUrl:""}),this.restore("init")},_closeProject:function(){i.setCurrentWebviewID(0),this.setState({project:"",commonUrl:""}),this.restore("init")},_setCursorLoading:function(t){this.setState({cursorLoading:t})},goToLogin:function(){this.setState({hasLogin:!1,commonUrl:"",project:""}),this.restore("init")},handleOnClick:function(t){e.bodyClick(t)},appQuit:function(){r.info("ContainController.js exit"),nw.App.quit()},appToMax:function(){var t=this.state.lastWinStatus,e=t.status;t.isFullscreen?j.enterFullscreen():"max"===e||void 0===e?j.maximize():this.restore()},appMax:function(){var t=this.state.lastWinStatus,e=t.status;"max"!==e?j.maximize():this.restore()},appMin:function(){global.Win.minimize()},goMain:function(t){var e=this;t?o.setProjectConfig(t,{refresh:!0},function(s){return s?void S(s):(e.setState({commonUrl:!1,project:t,type:t}),void e.appToMax())}):(this.setState({commonUrl:!0,project:"",type:f}),o.setProjectType(f),this.appToMax());t?v("project_open",t.appid):v("url_open")},_showSetting:function(){this.setState({showSetting:!this.state.showSetting})},render:function(){var e=void 0,s=!this.state.commonUrl&&!this.state.project,i={};return i[E.proxy]=!0,i[E.editor]=!s&&!!this.state.project,i[E.notify]=!s,e=this.state.hasLogin?s?t.createElement(u,{appQuit:this.appQuit,goMain:this.goMain,type:this.state.type}):t.createElement(g,{lastWinStatus:this.state.lastWinStatus,project:this.state.project,appQuit:this.appQuit,appMax:this.appMax,appMin:this.appMin}):t.createElement(a,{appQuit:this.appQuit}),t.createElement("div",{onClick:this.handleOnClick,style:this.state.cursorLoading?{cursor:"wait !important"}:{}},e,t.createElement(n,{show:this.state.showSetting,toggleShow:this._showSetting,project:this.state.project,enables:i,category:E,inSelectProject:s,setCursorLoading:this._setCursorLoading}),t.createElement(l,null),t.createElement(m,null),t.createElement(p,null),t.createElement(h,null),t.createElement(c,null))}});_exports=W}var _exports;init(),module.exports=_exports;