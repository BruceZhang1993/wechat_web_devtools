"use strict";var React=require("../../lib/react.js"),cssStr=require("../../cssStr/cssStr.js"),webviewActions=require("../../actions/webviewActions.js"),leftviewActions=require("../../actions/leftviewActions.js"),leftviewStores=require("../../stroes/leftviewStores.js"),webviewStores=require("../../stroes/webviewStores.js"),log=require("../../common/log/log.js"),domAttr=[{type:"share",name:"menu:share:appmessage",shareMenus:!0,src:"../images/share_friend.png",wording:"发送给朋友",show:!0},{type:"share",name:"menu:share:timeline",shareMenus:!0,src:"../images/share_moment.png",wording:"分享到朋友圈",show:!0},{type:"share",name:"menu:share:qq",shareMenus:!0,src:"../images/share_qq.png",wording:"分享到QQ",show:!0},{type:"share",name:"menu:share:weiboApp",shareMenus:!0,src:"../images/share_weibo.png",wording:"分享到腾讯微博",show:!0},{type:"share",name:"menu:share:QZone",shareMenus:!0,src:"../images/share_qzone.png",wording:"分享到QQ空间",show:!0},{type:"open",shareMenus:!1,src:"../images/open_via_browser.png",wording:"在浏览器中打开",show:!0},{type:"reload",shareMenus:!1,src:"../images/icon_refresh.png",wording:"刷新",show:!0}],menuListToIndex={"menuItem:share:appMessage":0,"menuItem:share:timeline":1,"menuItem:share:qq":2,"menuItem:share:weiboApp":3,"menuItem:share:QZone":4},hideMenusSdks={hideOptionMenu:!0,hideAllNonBaseMenuItem:!0},showMenusSdks={showOptionMenu:!0,showAllNonBaseMenuItem:!0},WebviewFooter=React.createClass({displayName:"WebviewFooter",getInitialState:function(){return{webviewID:parseInt(this.props.webviewID),showMenus:!0,show:!1,domAttr:JSON.parse(JSON.stringify(domAttr))}},_upWebviewStatus:function(e,s){"loadcommit"===s.type&&this.setState({showMenus:!0,domAttr:JSON.parse(JSON.stringify(domAttr))})},_setInterfaceRes:function(e,s,t,i){var n=void 0,r=JSON.parse(JSON.stringify(domAttr)),o=i.args;if(showMenusSdks[s])n=!0;else if(hideMenusSdks[s])n=!1;else if("showMenuItems"===s){n=!0;var a=o.menuList;a.forEach(function(e){var s=menuListToIndex[e];void 0!==s&&(r[s].show=!0)})}else if("hideMenuItems"===s){n=!0;var a=o.menuList;a.forEach(function(e){var s=menuListToIndex[e];void 0!==s&&(r[s].show=!1)})}this.setState({showMenus:n,domAttr:r})},_leftStatusUp:function(e,s){this.setState({show:s.showFooter})},componentDidMount:function(){var e=this.state.webviewID;leftviewStores.on("LEFT_STATUS_UP_"+e,this._leftStatusUp),webviewStores.on("SET_INTERFACE_RES_"+e,this._setInterfaceRes),webviewStores.on("UP_WEBVIEW_STATUS_"+e,this._upWebviewStatus)},componentWillUnmount:function(){var e=this.state.webviewID;leftviewStores.removeListener("LEFT_STATUS_UP_"+e,this._leftStatusUp),webviewStores.removeListener("SET_INTERFACE_RES_"+e,this._setInterfaceRes),webviewStores.removeListener("UP_WEBVIEW_STATUS_"+e,this._upWebviewStatus)},handleOnClick:function(e){var s=e.currentTarget,t=s.dataset,i=t.type;if("share"===i){var n=t.name;webviewActions.setWebviewAction(this.state.webviewID,{act:"sendMsg",sdkName:n,res:{}})}else"reload"===i?(webviewActions.setWebviewAction(this.state.webviewID,{act:"reLoad"}),leftviewActions.clickRightHeader(this.state.webviewID)):"open"===i&&(webviewActions.setWebviewAction(this.state.webviewID,{act:"open"}),leftviewActions.clickRightHeader(this.state.webviewID))},render:function(){var e=this,s=this.state.domAttr.map(function(s,t){return React.createElement("div",{style:s.show?{}:cssStr.displayNone,key:t,onClick:e.handleOnClick,"data-type":s.type,"data-name":s.name,className:"footer_icon"+(s.shareMenus?" js-menus":"")},React.createElement("img",{src:s.src}),React.createElement("p",null,s.wording))});return React.createElement("div",{style:this.state.show?cssStr.displayFlex:cssStr.displayNone,className:"body-webview-footer"+(this.state.showMenus?"":" js-menus_hide")},s)}});module.exports=WebviewFooter;