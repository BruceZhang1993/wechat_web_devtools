"use strict";var React=require("../../lib/react.js"),cssStr=require("../../cssStr/cssStr.js"),webviewStores=require("../../stroes/webviewStores.js"),webviewActions=require("../../actions/webviewActions.js"),leftviewActions=require("../../actions/leftviewActions.js"),log=require("../../common/log/log.js"),WebviewHeader=React.createClass({displayName:"WebviewHeader",getInitialState:function(){return{webviewID:parseInt(this.props.webviewID),canGoBack:!1,title:"",titleColor:{},left:"",right:"",backgroundColor:{},showBarLoading:!1}},_titleLock:!1,_upWebviewStatus:function(e,t){this._titleLock&&delete t.title,log.info("WebviewHeader.js UP_WEBVIEW_STATUS webviewID:"+e+" data:"+JSON.stringify(t)),Object.assign(this.state,t),this.setState(this.state)},_getA8keyDone:function(e){log.info("WebviewHeader.js GETA_8KEY_DONE webviewID:"+e),this.props.enableFullScreen(e,!1),this._titleLock=!1,this.setState({left:"",right:"",backgroundColor:{},titleColor:{},showBarLoading:!1})},_setInterfaceRes:function(e,t,i,s){if(i){log.info("WebviewHeader.js SET_INTERFACE_RES webviewID:"+e+" "+t);var a=s.args;if("setNavigationBarButtons"===t){var o=a.left||"",r=a.right||"";this.setState({left:o,right:r})}else if("setNavigationBarColor"===t){var n=a.color;this.setState({backgroundColor:{backgroundColor:n}})}else if("setPageTitle"===t){var l=a.title,n=a.color;this._titleLock=!0,this.setState({title:l,titleColor:n?{color:n}:{}})}else"enableFullScreen"===t?this.props.enableFullScreen(e,!0):"showNavigationBarLoading"===t?this.setState({showBarLoading:!0}):"hideNavigationBarLoading"===t&&this.setState({showBarLoading:!1})}},componentDidMount:function(){webviewStores.on("SET_INTERFACE_RES_"+this.state.webviewID,this._setInterfaceRes),webviewStores.on("UP_WEBVIEW_STATUS_"+this.state.webviewID,this._upWebviewStatus),webviewStores.on("GETA_8KEY_DONE_"+this.state.webviewID,this._getA8keyDone)},componentWillUnmount:function(){webviewStores.removeListener("GETA_8KEY_DONE_"+this.state.webviewID,this._getA8keyDone),webviewStores.removeListener("SET_INTERFACE_RES_"+this.state.webviewID,this._setInterfaceRes),webviewStores.removeListener("UP_WEBVIEW_STATUS_"+this.state.webviewID,this._upWebviewStatus)},handleClick:function(){webviewActions.setWebviewAction(this.state.webviewID,{act:"goBack"})},handleRightClick:function(){leftviewActions.clickRightHeader(this.state.webviewID)},render:function(){var e=this,t=this.state.canGoBack||0!==this.state.webviewID,i=this.state.left,s=i?i.text:"返回",a=i&&i.color?{color:i.color}:{},o=this.state.right,r=void 0;if(o){var n=o.hidden?cssStr.displayNone:{};o.color&&(n.color=o.color);var l=o.iconData,c=function(){webviewActions.setWebviewAction(e.state.webviewID,{act:"sendMsg",sdkName:"onNavigationBarRightButtonClick",res:"onNavigationBarRightButtonClick:ok"})};r=React.createElement("div",{onClick:c,className:"body-webview-header_operate"},React.createElement("span",{style:n},o.text),React.createElement("img",{style:l?{}:cssStr.displayNone,className:"webview-header-operate_userimg",src:l}))}else r=React.createElement("div",{onClick:this.handleRightClick,className:"body-webview-header_operate"},React.createElement("img",{className:"webview-header-operate_defaultimg",src:"../images/more.png"}));var w=Object.assign({},this.state.backgroundColor);return this.props.currentWebviewID!=this.state.webviewID&&(w=Object.assign(w,cssStr.displayNone)),React.createElement("div",{className:"body-webview-header",style:w},React.createElement("div",{onClick:this.handleClick,style:t?cssStr.visibilityVisible:cssStr.visibilityHidden,className:"body-webview-header_item"},React.createElement("span",{style:a},s)),React.createElement("div",{className:"body-webview-header_title"},React.createElement("span",{className:"body-webview-header_span",style:this.state.titleColor},React.createElement("img",{style:this.state.showBarLoading?{}:cssStr.displayNone,className:"body-webview-header_loading",src:"../images/loading.gif"}),React.createElement("span",{className:"body-webview-header_titleWording"},this.state.title))),r)}});module.exports=WebviewHeader;