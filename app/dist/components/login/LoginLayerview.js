"use strict";var React=require("../../lib/react.js"),request=require("../../common/request/request.js"),cssStr=require("../../cssStr/cssStr.js"),windowActions=require("../../actions/windowActions.js"),log=require("../../common/log/log.js"),urlConfig=require("../../config/urlConfig.js"),LoginLayerview=React.createClass({displayName:"LoginLayerview",getInitialState:function(){return{defualtQrUrl:"",qrUrl:urlConfig.LOGIN_URL}},componentDidUpdate:function(){this.refs.container;if(!this.props.showLoginLayer)return void(this.refs.container.innerHTML="");var e=document.createElement("webview");e.className="qrcode_img",e.src=this.state.qrUrl,e.style.display="none",e.addEventListener("loadstop",function(n){e.executeScript({code:"\n          var s = document.createElement('style')\n          s.innerText = `\n            body{\n              overflow:hidden;\n              background-color: #fff!important;\n              padding: inherit!important;\n              color: #373737!important;\n            }\n            .impowerBox .title {\n              display: none;\n            }\n            .impowerBox .info {\n              margin-left: -7px\n            }\n            .impowerBox .qrcode {\n              width: 137px;\n              margin-top: -7px;\n            }`\n            document.head.appendChild(s)\n            var normal = document.querySelectorAll('.normal')\n            for(var i = 0; i < normal.length; i++) {\n              normal[i].classList.remove('normal')\n            }\n        "}),e.style.display="block";var r=e.request;r.onBeforeRequest.addListener(function(e){if("main_frame"!==e.type)return{};var n=e.url;return log.info("LoginLayerview.js get URL : "+n),request({url:n},function(e,n,r){if(!e){log.info("LoginLayerview.js get res "+r);var i=n.headers,t=i["debugger-signature"],o=i["debugger-newticket"],a=+new Date;r=JSON.parse(r);var s={signature:t,newticket:o,openid:r.openid,nickName:r.nickname,headUrl:r.headurl||"../images/account.png",ticketExpiredTime:1e3*r.ticket_expired_time+a,signatureExpiredTime:1e3*r.signature_expired_time+a,sex:1===r.sex?"male":"female",province:r.province,city:r.city,contry:r.contry};windowActions.upDateUserInfo(s)}}),{cancel:!0}},{urls:["<all_urls>"]},["blocking"]),log.info("LoginLayerview.js init loginWebview")}),this.refs.container.innerHTML="",this.refs.container.appendChild(e)},handleOnClick:function(e){this.props.closeLoginLayer()},render:function(){return React.createElement("div",{style:this.props.showLoginLayer?{}:cssStr.displayNone,className:"popup popup_qrcode"},React.createElement("div",{className:"popup_mask",onClick:this.handleOnClick}),React.createElement("div",{className:"popup-content"},React.createElement("div",{className:"popup_qrcode_header"},React.createElement("img",{src:"../images/icon.ico"}),React.createElement("p",null,"微信web开发者工具")),React.createElement("div",{className:"popup_qrcode_body"},React.createElement("div",{ref:"container",className:"popup_qrcode_view"}))))}});module.exports=LoginLayerview;