"use strict";var React=require("../../lib/react.js"),SdkLogitem=require("./inc/SdkLogitem.js"),webviewStores=require("../../stroes/webviewStores.js"),cssStr=require("../../cssStr/cssStr.js"),webviewActions=require("../../actions/webviewActions.js"),windowActions=require("../../actions/windowActions.js"),sdkNameTrans=require("../../common/jssdk/sdkNameTrans.js"),sdkConfig=require("../../common/jssdk/sdkConfig.js"),webviewNum=0,SdkLogview=React.createClass({displayName:"SdkLogview",getInitialState:function(){return{webviewID:0,list:{0:{logs:[],errNum:0}}}},componentDidMount:function(){var e=this;webviewStores.on("DELETE_WEBVIEW_ID",function(t){delete e.state.list[t]}),webviewStores.on("CHANGE_WEBVIEW_ID",function(t){e.setState({webviewID:t})}),webviewStores.on("WEBVIEW_SDK",function(t,s,i,a,r){if("openUrlWithExtraWebview"===i){webviewNum++;var n=Object.assign({},e.state.list);n[webviewNum]={logs:[],errNum:0},e.setState({webviewID:webviewNum,list:n})}}),webviewStores.on("GETA_8KEY_DONE",function(t){var s=Object.assign({},e.state.list);s[t]={logs:[],errNum:0},e.setState({list:s})}),webviewStores.on("GET_JASSDK_LOG",function(t,s,i,a,r){var n=Object.assign({},e.state.list),o=n[t];o.logs.unshift({data:s,isHavePurview:i,sdkRes:a,sdkResExt:r}),e.setState({list:n});var c=!i;"REGISTER_SDK"!==r.type&&a&&a.errMsg&&-1===a.errMsg.indexOf(":ok")&&-1===a.errMsg.indexOf(":cancel")&&(c=a.errMsg!==sdkConfig.notExistWroding);var d=sdkNameTrans.getSdkDisplayName(s.sdkName),l=sdkNameTrans.formatArgs(s.sdkName,s.args),w=o.errNum;c&&o.errNum++,setTimeout(function(){webviewActions.setWebviewAction(t,{act:"JSSDKLOG",isErr:c,sdkName:d,type:r.type,inputArgs:l,sdkRes:a}),e.upSdkErrNum(t,w)},0)})},upSdkErrNum:function(e,t){windowActions.upSdkErrNum(e,t)},handleOnClick:function(){var e=this.state.webviewID,t=Object.assign({},this.state.list);t[e]={logs:[],errNum:0},this.setState({list:t}),this.upSdkErrNum(e,errNum)},render:function(){var e=this,t=this.state.webviewID,s=this.state.list[t].logs,i=s.map(function(t,s){return React.createElement(SdkLogitem,{key:s,data:t,webviewID:e.state.webviewID})});return React.createElement("div",{style:"SdkLogview"===this.props.selectSta?cssStr.displayBlock:cssStr.displayNone,className:"sdk-logview"},React.createElement("div",{className:"sdk-logview-header"},React.createElement("div",{className:"sdk-logview-header_type"},"type"),React.createElement("div",{className:"sdk-logview-header_name"},"name"),React.createElement("div",{className:"sdk-logview-header_info"},"info"),React.createElement("div",{onClick:this.handleOnClick,className:"sdk-logview-header_clear"},React.createElement("a",{className:"sdk-logview-clear_a",href:"javascript:;"},"清除记录"))),React.createElement("div",{className:"sdk-logview-body"},i))}});module.exports=SdkLogview;