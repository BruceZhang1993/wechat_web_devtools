"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},React=require("../../lib/react.js"),webviewStores=require("../../stroes/webviewStores.js"),cssStr=require("../../cssStr/cssStr.js"),tools=require("../../utils/tools.js"),path=require("path"),fs=require("fs"),report=require("../../utils/report.js"),WEINRE_TYPE=5,BLINK_TYPE=6,Purviewview=React.createClass({displayName:"Purviewview",getInitialState:function(){var e=tools.getSysIpInfo();return{webviewID:parseInt(this.props.webviewID),ip:e[0],ipAddress:e,proxyPort:global._port,ipAddressStyle:{display:"none"},deviceType:"Android",debugType:"Blink",showQRcode:!1}},_getWeinreInjectScript:function(){var e=path.join(__dirname,"../../../../modified_modules/weinre/plugins/network.js"),t=fs.readFileSync(e,"utf8");return t.replace("${global._weinrePort}",global._weinrePort)},handleOnClick:function(e){var t=this;if("Blink"===this.state.debugType)report([{type:BLINK_TYPE,times:1}]),tools.openInspectWin();else{var a=function(){report([{type:WEINRE_TYPE,times:1}]);var e=t.refs.ipselect.value,a=global.weinreWin[e];if(a)return a.win?a.win.focus():nw.Window.open(a.url,function(n){var i=t._getWeinreInjectScript();n.eval(null,i),global.weinreScript=a.weinreScript,global.weinreWin[e].win=n,n.maximize(),n.on("closed",function(){global.weinreScript=void 0,delete global.weinreWin[e].win})}),{v:void 0};var n=require("../../common/plugins/weinre.js");n(e,function(a,n){nw.Window.open(n,function(i){var c=t._getWeinreInjectScript();i.eval(null,c);var s='<script src="http://'+e+":"+a+'/target/target-script-min.js#anonymous"></script>';global.weinreWin[e]={weinreScript:s,port:a,url:n,init:!0,win:i,webviewId:t.state.webviewID},global.weinreScript=s,i.maximize(),i.on("closed",function(){global.weinreScript=void 0,delete global.weinreWin[e].win})})})}();if("object"===("undefined"==typeof a?"undefined":_typeof(a)))return a.v}},handleOnChange:function(e){this.setState({ip:e.target.value})},changeDevice:function(e){var t=e.target,a=t.dataset.type,n={deviceType:a};"iOS"===a&&(n.debugType="weinre"),this.setState(n)},changeDebug:function(e){var t=e.target,a=t.dataset.type;this.setState({debugType:a})},showQRcode:function(){this.setState({showQRcode:!0})},hideQRcode:function(){this.setState({showQRcode:!1})},openDocument:function(){nw.Shell.openExternal("https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1455784140&token=&lang=zh_CN")},render:function(){var e=this.state.ipAddress.map(function(e,t){return React.createElement("option",{key:e,value:e},e)});return React.createElement("div",{style:"MobileDebugview"===this.props.selectSta?{}:cssStr.displayNone,className:"mobile-content"},React.createElement("div",{className:"mobile-content-os"},React.createElement("div",{className:"mobile-content-os_item"},React.createElement("img",{"data-type":"iOS",onClick:this.changeDevice,className:"mobile-content-os_image",src:"../images/iphone.png"}),React.createElement("span",{className:"mobile-content-os_check"},React.createElement("label",null,React.createElement("input",{"data-type":"iOS",onChange:this.changeDevice,checked:"iOS"===this.state.deviceType,className:"mobile-content-details_checkbox",type:"radio",name:"debugos"}),"iOS 设备调试"))),React.createElement("div",{className:"mobile-content-os_item"},React.createElement("img",{"data-type":"Android",onClick:this.changeDevice,className:"mobile-content-os_image",src:"../images/android.png"}),React.createElement("span",{className:"mobile-content-os_check"},React.createElement("label",null,React.createElement("input",{"data-type":"Android",onChange:this.changeDevice,checked:"Android"===this.state.deviceType,className:"mobile-content-details_checkbox",type:"radio",name:"debugos"}),"Android 设备调试")))),React.createElement("div",{className:"mobile-content-os_border"}),React.createElement("div",{className:"mobile-content-container"},React.createElement("div",{className:"mobile-content-details"},React.createElement("div",{style:"Android"===this.state.deviceType?{}:cssStr.displayNone},React.createElement("p",{className:"mobile-content-title"},"调试方式："),React.createElement("div",{className:"mobile-content-details_item"},React.createElement("label",null,React.createElement("input",{"data-type":"Blink",checked:"Blink"===this.state.debugType,onChange:this.changeDebug,className:"mobile-content-details_checkbox",type:"radio",name:"debugtype"}),"X5 Blink 内核调试"),React.createElement("span",{className:"mobile-content_p"}," 推荐，包括脚本断点在内的原生调试功能，",React.createElement("a",{onClick:this.showQRcode,href:"javascript:;"},"点击验证 "),"移动设备是否支持。")),React.createElement("div",{className:"mobile-content-details_item"},React.createElement("label",null,React.createElement("input",{"data-type":"weinre",onChange:this.changeDebug,checked:"weinre"===this.state.debugType,className:"mobile-content-details_checkbox",type:"radio",name:"debugtype"}),"普通调试"))),React.createElement("div",{style:"weinre"===this.state.debugType?{}:cssStr.displayNone},React.createElement("p",{className:"mobile-content-title"},"调试步骤："),React.createElement("div",{className:"mobile-content-details_item"},React.createElement("span",{className:"mobile-content-item_index"},"1"),React.createElement("span",null,"选择调试的无线网卡地址 "),React.createElement("select",{onChange:this.handleOnChange,ref:"ipselect",className:"mobile-ipaddress_contain_select"},e)),React.createElement("div",{className:"mobile-content-details_item"},React.createElement("span",{className:"mobile-content-item_index"},"2"),React.createElement("span",null,"确保本机和移动设备在同一局域网网段中 ")),React.createElement("div",{className:"mobile-content-details_item"},React.createElement("span",{className:"mobile-content-item_index"},"3"),React.createElement("span",null,"请按照如下步骤将移动设备的网络代理配置到：",React.createElement("b",null,"http://",this.state.ip)," 端口： ",React.createElement("b",null,this.state.proxyPort)),React.createElement("p",{style:"Android"===this.state.deviceType?cssStr.displayNone:{},className:"mobile-content_p"}," iOS： 设置 - 无线局域网 - 选中网络 - HTTP代理手动"),React.createElement("p",{style:"Android"===this.state.deviceType?{}:cssStr.displayNone,className:"mobile-content_p"}," Android： 设置 - WLAN - 长按选中网络 - 修改网络 - 高级 - 代理设置 - 手动")),React.createElement("div",{className:"mobile-content-details_item"},React.createElement("span",{className:"mobile-content-item_index"},"4"),React.createElement("span",null,"重启微信，并在微信中访问网页"))),React.createElement("div",{className:"mobile-content-details_x5",style:"Blink"===this.state.debugType?{}:cssStr.displayNone},React.createElement("div",{className:"mobile-content-details"},React.createElement("p",{className:"mobile-content-title"},"调试步骤："),React.createElement("div",{className:"mobile-content-details_item"},React.createElement("img",{src:"../images/x5step.png"})),React.createElement("a",{className:"mobile-content-document_a",onClick:this.openDocument,href:"javascript:;"},React.createElement("img",{src:"../images/reading_icon.png"}),"点击阅读 X5 Blink 调试的详细文档"))))),React.createElement("div",{className:"mobile-content-os_border"}),React.createElement("div",{className:"mobile-content-container"},React.createElement("div",{className:"btn-wrap"},React.createElement("span",{className:"btn btn_primary","data-type":"weinre",onClick:this.handleOnClick},"开始调试"))),React.createElement("div",{style:this.state.showQRcode?{}:cssStr.displayNone,className:"popup"},React.createElement("div",{className:"popup_mask",onClick:this.hideQRcode}),React.createElement("div",{className:"popup-content mobile-content-x5_qrcode"},React.createElement("div",{className:"mobile-content-x5_qrimg"},React.createElement("img",{src:"../images/x5qrcode.png",width:230,height:230}),React.createElement("p",{className:"mobile-content-x5_p"},"扫码验证设备是否支持X5 Blink调试")))))}});module.exports=Purviewview;