"use strict";var React=require("../../lib/react.js"),cssStr=require("../../cssStr/cssStr.js"),windowStores=require("../../stroes/windowStores.js"),webviewActions=require("../../actions/webviewActions.js"),windowActions=require("../../actions/windowActions.js"),config=require("../../config/config.js"),request=require("../../common/request/request.js"),DeviceModules=require("./DeviceModules.js"),Settingview=React.createClass({displayName:"Settingview",getInitialState:function(){var e=localStorage.getItem("setting");return e?(e=JSON.parse(e),e.currentProxyHost=e.proxyHost,e.currentProxyPort=e.proxyPort,e):{show:!1,os:"iOS",currentOs:"iOS",version:config.defaultWechatVersion,currentVersion:config.defaultWechatVersion,versionList:[],proxyType:"SYSTEM",currentProxyType:"SYSTEM",proxyHost:"",currentProxyHost:"",proxyPort:"",currentProxyPort:"",device:"iPhone 6",currentDevice:"iPhone 6"}},componentDidMount:function(){var e=this;windowStores.on("SHOW_SETTING",function(){e.setState({show:!0})}),request({url:"http://weixin.qq.com/cgi-bin/readtemplate?t=weixin_faq_list",needToken:!1},function(t,a,s){if(!t)try{!function(){var t=s.indexOf("<h2>iOS平台</h2>"),a=s.indexOf("<h2>Android平台</h2>");s=s.slice(t,a),s=s.match(/微信\s(.*)\sfor/g);var r=[];s.forEach(function(e){e=e||"";var t=e.replace("微信","").replace("for","").trim();t&&parseInt(t[0],10)>4&&r.push(t)}),e.setState({versionList:r}),localStorage.setItem("setting",JSON.stringify(e.state))}()}catch(r){}})},handleOnChange:function(e){var t=e.currentTarget,a=t.dataset,s=a.type,r=void 0;r="USER"!==s?s:"PROXY "+this.state.proxyHost+":"+this.state.proxyPort,this.setState({proxyType:r})},proxyHostChange:function(e){var t=e.target.value,a=this.state.proxyPort||"80",s="PROXY "+t+":"+a;this.setState({proxyType:s,proxyHost:t})},proxyPortChange:function(e){var t=e.target.value,a=this.state.proxyHost,s="PROXY "+a+":"+t;this.setState({proxyType:s,proxyPort:t})},deviceChange:function(e){var t=e.target.value,a=DeviceModules[t],s=a.os;this.setState({device:t,os:s})},handleOnClick:function(e){var t=this,a=e.currentTarget,s=a.dataset,r=s.type;if("close"===r)this.setState({version:this.state.currentVersion,os:this.state.currentOs,device:this.state.currentDevice,show:!1,proxyType:this.state.currentProxyType,proxyPort:this.state.currentProxyPort,proxyHost:this.state.currentProxyHost});else if("save"===r)!function(){var e=function(){webviewActions.setWebviewUA({version:t.state.version,os:t.state.os,device:t.state.device}),t.setState({currentProxyType:t.state.proxyType,currentVersion:t.state.version,currentOs:t.state.os,currentDevice:t.state.device,show:!1},function(){localStorage.setItem("setting",JSON.stringify(t.state))})};t.state.currentProxyType!==t.state.proxyType?windowActions.updataProxySetting(t.state.proxyType,function(){setTimeout(function(){e()})}):e()}();else if("wechat"===r){var c=s.version;this.setState({version:c})}else if("phone"===r){var n=s.phone,i="iPhone 6";"iOS"!==n&&(i="Nexus 5x"),this.setState({os:n,device:i})}},render:function(){var e=this,t=this.state.versionList.map(function(t){var a="wx-version"+(t==e.state.version?" wx-version_selected":"");return React.createElement("div",{key:t,onClick:e.handleOnClick,"data-type":"wechat","data-version":t,className:a},t)}),a=[];for(var s in DeviceModules){var r=DeviceModules[s];a.push(React.createElement("option",{key:s,value:r.title},r.title))}var c=DeviceModules[this.state.device],n=c?c.screen.vertical.width:0,i=c?c.screen.vertical.height:0,o=c?c.screen["device-pixel-ratio"]:0,l="SYSTEM"!==this.state.proxyType&&"DIRECT"!==this.state.proxyType;return React.createElement("div",{className:"popup",style:this.state.show?{}:cssStr.displayNone},React.createElement("div",{onClick:this.handleOnClick,"data-type":"close",className:"popup_mask"}),React.createElement("div",{className:"popup-content"},React.createElement("span",{onClick:this.handleOnClick,"data-type":"close",className:"close_icon"}),React.createElement("div",{className:"popup-content_header"},"设置"),React.createElement("div",{className:"popup-content_body"},React.createElement("div",{className:"section_control"},React.createElement("p",{className:"section_titile"},"设置模拟器手机系统"),React.createElement("div",{className:"section_wrap"},React.createElement("div",{onClick:this.handleOnClick,"data-type":"phone","data-phone":"iOS",className:"wx-version"+("iOS"===this.state.os?" wx-version_selected":"")},"iOS"),React.createElement("div",{onClick:this.handleOnClick,"data-type":"phone","data-phone":"Android",className:"wx-version"+("Android"===this.state.os?" wx-version_selected":"")},"Android"))),React.createElement("div",{className:"section_control"},React.createElement("p",{className:"section_titile"},"设置移动设备模拟"),React.createElement("div",{className:"section_wrap"},React.createElement("select",{className:"section-device-os",value:this.state.device,onChange:this.deviceChange},a),React.createElement("span",{style:c?{}:cssStr.displayNone,className:"section-device-os_screen"}," ",n," × ",i),React.createElement("span",{style:c?{}:cssStr.displayNone,className:"section-device-os_screen"}," Dpr: ",o))),React.createElement("div",{className:"section_control"},React.createElement("p",{className:"section_titile"},"设置模拟器微信版本"),React.createElement("div",{className:"section_wrap"},t)),React.createElement("div",{className:"section_control"},React.createElement("p",{className:"section_titile"},"设置代理"),React.createElement("div",{className:"checkbox_wrap proxy-wrap"},React.createElement("label",{className:"proxy-wrap_label"},React.createElement("input",{type:"checkbox","data-type":"SYSTEM",onChange:this.handleOnChange,checked:"SYSTEM"===this.state.proxyType}),"使用系统代理，勾选后将使用系统代理")),React.createElement("div",{className:"checkbox_wrap proxy-wrap"},React.createElement("label",{className:"proxy-wrap_label"},React.createElement("input",{type:"checkbox","data-type":"DIRECT",onChange:this.handleOnChange,checked:"DIRECT"===this.state.proxyType}),"不使用任何代理，勾选后将直连网络")),React.createElement("div",{className:"checkbox_wrap proxy-wrap"},React.createElement("label",{className:"proxy-wrap_label"},React.createElement("input",{type:"checkbox","data-type":"USER",onChange:this.handleOnChange,checked:l}),"手动设置代理"),React.createElement("input",{onChange:this.proxyHostChange,value:this.state.proxyHost,disabled:l?!1:!0,className:"proxy_address proxy-wrap_url_address",type:"text",placeholder:"代理地址"}),React.createElement("input",{onChange:this.proxyPortChange,value:this.state.proxyPort,disabled:l?!1:!0,className:"proxy_address proxy-wrap_url_port",type:"text",placeholder:"端口"}))),React.createElement("div",{className:"btn_wrap"},React.createElement("span",{onClick:this.handleOnClick,"data-type":"save",className:"btn btn_primary"},"保存"),React.createElement("span",{onClick:this.handleOnClick,"data-type":"close",className:"btn btn_default"},"取消")))))}});module.exports=Settingview;