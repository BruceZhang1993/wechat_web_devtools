"use strict";function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function init(){var e,t=require("events").EventEmitter,i=require("../common/jssdk/sdk.js"),r=require("../common/getA8key/getA8key.js"),n=require("../config/errcodeConfig.js"),o=(require("../config/config.js"),require("../common/log/log.js")),s=(require("../config/DeviceModules.js"),require("../config/wordingConfig.js")),_={},S={},u=0,c="app/html/about.html",a={},E=localStorage["webview-network-type"]?localStorage["webview-network-type"]:"wifi",f={appServiceReady:!1},T=Object.assign({},t.prototype,(e={addWebviewPorts:function(e,t){return a[e]=t,a},delWebviewPorts:function(e){return delete a[e],a},getNetworkType:function(){return E},setNetworkType:function(e){E=e,localStorage["webview-network-type"]=E,this.emit("SIMULATOR_NETWORK_CHANGE",E)},getStatusBarHeight:function(){var e=parseInt(localStorage["webview-status-bar-height"]);return(Number.isNaN(e)||e<0)&&(e=25),e},setStatusBarHeight:function(e){localStorage["webview-status-bar-height"]=e,this.emit("SIMULATOR_STATUS_BAR_HEIGHT_CHANGE",e)},getWebviewPorts:function(){return a},deleteWebviewID:function(e){this.emit("DELETE_WEBVIEW_ID",e)},changeWebviewID:function(e){u=e,this.emit("CHANGE_WEBVIEW_ID",e)},getSnapShot:function(e){return S[e]},setSnapShot:function(e,t){S[e]=t,this.emit("SET_WEBVIEW_SNAPSHOT",e,t)},getInitURL:function(){return c},setInitURL:function(e){c=e},getCurrentWebviewID:function(){return u},setCurrentWebviewID:function(e){u=e},showShare:function(e,t){this.emit("SHOW_SHARE_WEBVIEW_"+e,e,t)},stopPullDownRefresh:function(){this.emit("STOP_PULL_DOWN_REFRESH")},upStatus:function(e,t){_[e]||(_[e]={}),this.emit("UP_WEBVIEW_STATUS_"+e,e,t),this.emit("UP_WEBVIEW_STATUS",e,t)},setAction:function(e,t){_[e]||(_[e]={}),this.emit("SET_WEBVIEW_ACTION_"+e,e,t)},execJSSDK:function(e,t){var r=this;_[e]||(_[e]={}),setTimeout(function(){i.exec(t,_[e],function(i,s,S){var u=t.sdkName,c=S.type;if("CARD_SDK"===c&&i){var a=S.error;if(a){if(a.errcode===n.NOT_LIMITS_CARD)return o.info("webviewStores.js getA8key NOT_LIMITS_CARD"),void r.emit("NOT_LIMITS_CARD");if(0!==a.errcode){o.info("webviewStores.js getA8key "+a.errcode);var E=require("../common/jssdk/sdkNameTrans.js");return s={errMsg:E.getSdkDisplayName(u)+":fail"},void r.emit("GET_JSSDK_RES_"+e,e,u,s,t.ext)}}else r.emit("CRAD_SDK_RES",e,u,s,i,t)}else"PREVERIFY_SDK"===c?(_[e].purviewFromPreVerify=S.purviewFromPreVerify||{},t.sdkResExt=S,r.emit("GET_JSSDK_RES_"+e,e,u,s,t)):"SHARE_SDK"===c?r.emit("SHOW_SHARE_WEBVIEW_"+e,e,t,s):"REGISTER_SDK"===c||("INTERFACE_ASYNC_SDK"===c?r.emit("SET_INTERFACE_ASYNC_RES",e,u,i,t):"INTERFACE_SDK"===c?(r.emit("SET_INTERFACE_RES_"+e,e,u,i,t),r.emit("GET_JSSDK_RES_"+e,e,u,s,t.ext)):r.emit("GET_JSSDK_RES_"+e,e,u,s,t.ext))})})},sendJSSDKRes:function(e,t,i,r){this.emit("GET_JSSDK_RES_"+e,e,t,i,r)},getA8key:function(e,t){var i=this;_[e]={};var S=t.isSync;o.info("webviewStores.js getA8key begin: "+e+" "+JSON.stringify(t)),r.get(t,function(r){o.info("webviewStores.js getA8key end: "+JSON.stringify(r));var u=r.baseresponse,c=parseInt(u.errcode);if(c===n.NOT_LOGIN)return o.info("webviewStores.js getA8key NOT_LOGIN"),void i.emit("NOT_LOGIN");if(c===n.NOT_LIMITS)return o.info("webviewStores.js getA8key NOT_LIMITS"),void i.emit("NOT_LIMITS");if(c===n.NOT_LIMITS_QY)return o.info("webviewStores.js getA8key NOT_LIMITS_QY"),void i.emit("NOT_LIMITS_QY");if(c===n.INVALID_LOGIN||c===n.INVALID_TOKEN)return o.info("webviewStores.js getA8key INVALID_LOGIN"),void i.emit("INVALID_LOGIN");_[e].purviewFormGetA8key=r.purviewFormGetA8key;var a=r.resp_url;if(S||c===n.ILLEGAL_URL)return void setTimeout(function(){i.emit("SET_WEBVIEW_ACTION_"+e,e,{act:"load",url:a,from:t.from})});if(0!==c){o.info("webviewStores.js getA8key "+c);var E=require("../actions/windowActions.js");return void E.showTipsMsg({msg:s[0]+" "+c,type:"error"})}var f=/\#wechat_redirect$/.test(t.url);return f&&t.url.replace(/\#wechat_redirect$/,"")===a?(a=a.replace(/\#wechat_redirect/,""),o.info("webviewStores.js getA8key GETA_8KEY_NOT_SUPPORT "+a),void windowActions.showTipsMsg({msg:""+s[1],type:"error"})):void 0})},getWebviewByID:function(e){return _[e]},clearData:function(e){this.emit("CLEAR_WEBVIEW_DATA",e)},setInterfaceFromPageFrame:function(e,t){this.emit("SET_INTERFACT_FROMPAGEFRAME_"+e,t)},cleanWebview:function(e){this.emit("CLEAN_WEBVIEW_"+e),this.emit("CLEAN_WEBVIEW",e)},asTojs:function(e){this.emit("AS_TO_JS",e)},upASData:function(e,t){this.emit("UP_AS_DATA",e,t)},upBLData:function(e,t){this.emit("UP_BL_DATA",e,t)},asPublish:function(e){this.emit("AS_PUBLISH",e)},postMessageToAS:function(e){this.emit("POST_MSG_TOAS",e)},sendASSdk:function(e,t,i){this.emit("SEND_AS_SDK",e,t,i)},touchSetSuc:function(e){this.emit("TOUCH_SET_SUC_"+e)},togglerRecordWording:function(e){this.emit("TOGGLE_RECORD_WORDING",e)},getGeoSetting:function(){var e=JSON.parse(localStorage.getItem("webivew-geolocation"))||{};return e},setGeoSetting:function(e){localStorage.setItem("webivew-geolocation",JSON.stringify(e))},drawWidgetCanvas:function(e){this.emit("WIDGET_DRAW_CANVAS",e)},getAppServiceReadyState:function(){return f.appServiceReady},setAppServiceReadyState:function(e){f.appServiceReady=e,e&&this.emit("APPSERVICE_INIT")},operatePaymentQrcodeWnd:function(e){this.emit("OPERATE_PAYMENT_QRCODE_WND",e)},showAddCardView:function(e){this.emit("SHOW_ADD_CARD_VIEW",e)},showOpenCardView:function(e){this.emit("SHOW_OPEN_CARD_VIEW",e)},showShareGroupList:function(e){this.emit("SHOW_SHARE_GROUP_LIST",e)},triggerWebviewOnEvent:function(e){this.emit("TRIGGER_WEBVIEW_ON_EVENT",e)}},_defineProperty(e,"showShareGroupList",function(){this.emit("SHOW_SHARE_GROUP_LIST")}),_defineProperty(e,"triggerGettingWidgetData",function(e){this.emit("GET_WIDGET_DATA",e)}),e)),A=T.on,I={};T.on=function(){var e=arguments,t=e[0];I[t]||(I[t]=0),I[t]++,I[t]>=10&&o.error("webviewStores.js on "+t+" - times: "+I[t]),A.apply(this,arguments)};var m=T.removeListener;T.removeListener=function(){var e=arguments,t=e[0];I[t]&&I[t]--,I[t]>=10&&o.error("webviewStores.js on "+t+" - times: "+I[t]),m.apply(this,arguments)},_exports=T}var _exports;init(),module.exports=_exports;