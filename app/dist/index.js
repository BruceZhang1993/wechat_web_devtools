"use strict";var tools=require("../dist/utils/tools.js");global.appConfig=tools.getAppConfig();var React=require("../dist/lib/react.js"),ReactDOM=require("../dist/lib/react-dom.js"),loadInit=require("../dist/common/loadInit/init.js"),ContainController=require("../dist/components/ContainController.js"),startProxy=require("../dist/common/proxy/startProxy.js"),windowActions=require("../dist/actions/windowActions.js"),webviewActions=require("../dist/actions/webviewActions.js"),webviewStores=require("../dist/stroes/webviewStores.js"),log=require("../dist/common/log/log.js"),menu=require("../dist/common/menu/menu.js"),shortCut=require("../dist/common/shortCut/shortCut.js");nw.Window.get().menu=menu,global.contentDocumentBody=document.body,document.title=nw.App.manifest.window.title;var isDev=global.appConfig.isDev||!!process.execPath.match("nw.exe")||!!process.execPath.match("nwjs.app");nw.App.on("open",function(e){var n=tools.getArgsURL(e);if(n){log.info("index.js Reopen App with url: "+n);var o=webviewStores.getCurrentWebviewID();webviewActions.getA8keyWebview(o,{url:n,isSync:!0,from:"urlbar"})}nw.Window.get().focus()});var openURL=tools.getArgsURL(nw.App.argv);openURL&&(log.info("index.js Open App with url: "+openURL),webviewActions.setInitURL(openURL)),shortCut.register(),global.weinreWin={};var timer=void 0;window.addEventListener("resize",function(){timer=setTimeout(function(){clearTimeout(timer),windowActions.resize(document.body.offsetHeight)},20)}),window.addEventListener("keydown",function(e){var n=e.keyCode;123===n&&(windowActions.changeDevtools(),e.preventDefault())}),!isDev&&window.addEventListener("contextmenu",function(e){e.preventDefault()});var Win=nw.Window.get();Win.on("focus",function(){shortCut.register()}),Win.on("blur",function(){shortCut.unRegister()}),Win.on("navigation",function(e,n,o){log.info("index.js navigation "+n+" ignore"),nw.Shell.openExternal(n),o.ignore()}),Win.on("new-win-policy",function(e,n,o){log.info("index.js new-win-policy "+n+" ignore"),o.ignore()}),Win.on("close",function(){log.info("index.js close"),process.exit()}),startProxy(function(e){loadInit(),log.info("index.js init proxy with "+e+" success!!"),Win.maximize();var n=function(){windowActions.resize(document.body.offsetHeight),ReactDOM.render(React.createElement(ContainController,null),document.querySelector("#container"))};"complete"===document.readyState?n():window.addEventListener("load",n)});