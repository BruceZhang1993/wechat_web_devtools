"use strict";function init(){function e(e,i){var t=e.args,r=t.tempFilePath,a=f.getFileStat(r);if(r&&a){var s=n.getCurrentProjectConfig(),l=n.getCurrentProject(),o=f.getSavedFileList(l);if(1024*s.Setting.MaxFileStorageSize*1024<o.totalSize+a.size)i({errMsg:"saveFile:fail the maximum size of the file storage limit is exceeded"});else{var g=f.saveFileForever(r);i(g===!1?{errMsg:"saveFile:fail"}:{errMsg:"saveFile:ok",savedFilePath:g})}}else i({errMsg:"saveFile:fail file not found"})}function i(e,i){var t=e.args,r=t.filePath,a=t.fileType,s=!1;if(a)s=!u["."+a];else{var l=v.extname(r).toLowerCase();s=!u[l]}if(s)return void i({errMsg:"openDocument:fail filetype not supported"});var o=f.getRealPath(r);if(!g.existsSync(o))return void i({errMsg:"openDocument:fail fail file not exist"});if(a){var n=g.readFileSync(o);o=o+"."+a,g.writeFileSync(o,n),nw.Shell.openItem(o)}else nw.Shell.openItem(o);i({errMsg:"openDocument:ok"})}function t(e,i){var t=n.getCurrentProject(),r=f.getSavedFileList(t);i({errMsg:"getSavedFileList:ok",fileList:r.fileList})}function r(e,i){var t=e.args;if(t.filePath){var r=f.getFileStat(t.filePath);i(r?{errMsg:"getSavedFileInfo:ok",size:r.size,createTime:parseInt(r.ctime.getTime()/1e3)}:{errMsg:"getSavedFileInfo:fail file doesn't exist"})}else i({errMsg:"getSavedFileInfo:fail"})}function a(e,i){var t=e.args;i(t.filePath?f.removeSavedFile(t.filePath)?{errMsg:"removeSavedFile:ok"}:{errMsg:"removeSavedFile:fail file doesn't exist"}:{errMsg:"removeSavedFile:fail"})}function s(e,i){var t=e.args,r=n.getCurrentProject();if(t.base64Data){var a=f.saveBase64DataToFile(r,t.base64Data,".jpg");i(a?{errMsg:"base64ToTempFilePath:ok",tempFilePath:a}:{errMsg:"base64ToTempFilePath:fail"})}else i({errMsg:"base64ToTempFilePath:fail"})}function l(e,i){var t=e.args,r=t.filePath,a=t.length,s=t.position||0,l=f.getRealPath(r);if(!g.existsSync(l))return i({errMsg:"readFile:fail file not found"});var o=g.createReadStream(l,{start:s,end:a?s+a:void 0}),n=[];o.on("data",function(e){n.push(e)}),o.on("end",function(){var e=Buffer.concat(n);i({errMsg:"readFile:ok",data:e.toString("base64")})})}function o(e,i){var t=e.args,r=t.filePath,a=t.data,s=t.position||0,l=f.getRealPath(r);return g.existsSync(l)?void g.open(l,"w",function(e,t){if(e)return i({errMsg:"writeFile:fail "+e});var r=Buffer.from(a,"base64");g.write(t,r,s,r.length,0,function(e,t,r){i(e?{errMsg:"writeFile:fail "+e}:{errMsg:"writeFile:ok"})})}):i({errMsg:"writeFile:fail file not found"})}var n=(require("../../actions/webviewActions.js"),require("../../stores/projectStores.js")),f=require("../../utils/file.js"),g=require("fs"),v=require("path"),u={".doc":!0,".xls":!0,".ppt":!0,".pdf":!0,".docx":!0,".xlsx":!0,".pptx":!0};_exports={saveFile:e,openDocument:i,getSavedFileList:t,getSavedFileInfo:r,removeSavedFile:a,base64ToTempFilePath:s,readFile:l,writeFile:o}}var _exports;init(),module.exports=_exports;