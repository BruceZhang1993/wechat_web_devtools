"use strict";function init(){function e(e){var r=e.headers.host,i=e.connection.encrypted&&!/^http:/.test(e.url)?"https":"http",o="http"===i?e.url:i+"://"+r+e.url,n=t.parse(o);return n.pureHref=n.href.replace(/\?.*/,"").replace(/\#.*/,""),n}var t=(require("fs"),require("url")),r=require("path"),i=(require("zlib"),require("../../utils/report.js"),require("../../weapp/weApp.js")),o=require("../../config/config.js"),n="https://clients1.google.com/tbproxy/af/",p=o.weappURLRegular,s=o.weappASURLRegular,u=o.weappLocalIdRegular,a=o.weappWidgetPageRegular,c=o.weappWidgetServiceRegular;_exports={shouldUseLocalResponse:function(t,r){var i=e(t),o=i.pureHref;return!!p.test(o)||(0===o.indexOf(n)||(!!s.test(o)||(!!u.test(o)||(!!a.test(o)||!!c.test(o)))))},dealLocalResponse:function(t,o,l){var f=e(t),d=f.pureHref;if(p.test(d)){var g=f.href;i.getResponse(g,function(e,t,i){if(e)return void l(e,t,i||"");r.extname(g).replace(".","");l(200,t,i)})}else 0===d.indexOf(n)?l(400,{},""):s.test(d)?i.getAppservice(d,function(e,t,r){return e?void l(e,{},r):void l(200,t,r)}):c.test(d)?i.getWidget(d,function(e,t,r){return e?void l(e,{},r):void l(200,t,r)}):a.test(d)?i.getWidgetPage(d,function(e,t,r){return e?void l(e,{},r):void l(200,t,r)}):u.test(d)&&i.getLocalIdResponse(d.replace(u,"wxfile://"),function(e,t,r){return e?void l(e,{},r):void l(200,t,r)})}}}var _exports;init(),module.exports=_exports;