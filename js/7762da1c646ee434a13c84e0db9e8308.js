'use strict';!function(require,directRequire){function a(a){let b=a.split('.'),c=parseInt(b[0]),d=parseInt(b[1]),e=parseInt(b[2]);if(c>H)return'app';return c==H&&d>I?'big_code':c==H&&d==I&&e>J&&'small_code'}async function b(a,b){L=!0,v({title:`有新版本`,message:`新版本 ${a} 已经准备好，立刻重启安装？`,buttons:[{title:'\u5B89\u88C5\u65B0\u7248\u672C'}],callback:(a)=>{if(0===a){let a=A?'open':b,c=A?[b]:[];try{r(a,c,{detached:!0,cwd:y})}catch(a){nw.Shell.openItem(o.join(y,b))}nw.App.quit()}}}),await B.open(),await B.insert('noticecenter',[{type:C.DBType.tools,title:'\u7248\u672C\u66F4\u65B0',content:`最新的开发工具版本 ${a}`,link:b,timestamp:Date.now()}]),await B.close()}function c(a){v({title:`有新版本`,message:`新版本 ${a} 已经准备好，立刻重启更新？`,buttons:[{title:'\u91CD\u542F'}],callback:(a)=>{0===a&&chrome.runtime.reload()}})}function d(a,c){if(K)return;let d=A?'darwin':'x64'===process.arch?'x64':'ia32',e={url:c?c:`${E}&type=${d}`},f=`${d}_${a}.${A?'ndmg':'nexe'}`,g=o.join(y,f),h=`${d}_${a}.${A?'dmg':'exe'}`,i=o.join(y,h);l.existsSync(i)?b(a,h):(s(e,(c)=>{c||l.rename(g,i,(c)=>{c||b(a,h)}),K=!1}).pipe(l.createWriteStream(g,{mode:511})),K=!0)}function e(){return new Promise((a,b)=>{let c={url:`${E}&type=small_code`,needToken:0,encoding:null};s(c,(c,d,e)=>{c?b(c):a(e)})})}function f(a){return new Promise((b,c)=>{m.gunzip(a,(a,d)=>{a?c(a):b(d)})})}function g(a,b){let c=o.join(y,b.toString());p.sync(c);let d=A?o.join(c,'app.nw'):o.join(c,'package.nw');n.extractAll(a,d);let e=o.join(d,'package.json'),f=JSON.parse(l.readFileSync(e,'utf8'));f['chromium-args']=A?'--disable-devtools --enable-experimental-web-platform-features -load-extension=/Applications/wechatwebdevtools2.app/Contents/Resources/app.nw/js/extensions/devtools/ -ignore-certificate-errors':'--disable-devtools --enable-experimental-web-platform-features -load-extension=./package.nw/js/extensions/devtools/ -ignore-certificate-errors',l.writeFileSync(e,JSON.stringify(f),'utf8')}async function h(a,b){if('app'===b||'big_code'===b)return void d(a);let h=o.join(y,a.toString()),i=o.join(y,`${b}${a}`);if(l.existsSync(i)&&l.existsSync(h))return D.newVersion=a,void c(a);try{let b=await e();b=await f(b),l.writeFileSync(i,b),g(i,a),D.newVersion=a,c(a)}catch(a){w.error(`onLineDownLoad download small_code error ${a}`)}}function i(a='0.0.0.0'){if(x.getAPIVersion()!==a)x.update();else try{l.existsSync(M)&&l.existsSync(O)&&l.existsSync(N)||x.update()}catch(a){w.error(`update latest api failed with error ${a}`)}}function j(b){return a(b.last_ide)}function k(a){let b=A?a.mac_url:'x64'===process.arch?a.x64_url:a.ia32_url;d(a.last_ide,b)}const l=require('fs'),m=require('zlib'),n=require('asar'),o=require('path'),p=require('mkdir-p'),q=require('glob'),r=require('child_process').spawn,s=require('./233d77ecf0781f44985f684f70e316d0.js'),t=require('./f171257bbcaef547a3cf27266ccb0db2.js'),u=require('./92320c1386e6db6a6f2556736a9bc280.js'),v=require('./d3ce001ab1e75959382f6a7e0156dd17.js'),w=require('./72653d4b93cdd7443296229431a7aa9a.js'),x=require('./4e88c741ca9fb65fab96c500b6d7f2fb.js'),y=u.WeappApplication,z=o.join(y,'uplog.json'),A='darwin'===process.platform,B=require('./4102b43ad51182743111f5d5e1fc5b46.js'),C=require('./bcb48ae14d243711d3b31cb0f602d209.js'),D=require('./84858de8a097c9cf84ff2c2e3d86e2a9.js'),E=`${t.downloadRedirectURL}?os=${A?'darwin':'win'}`,F=global.appVersion,G=F.split('.'),H=parseInt(G[0]),I=parseInt(G[1]),J=parseInt(G[2]);var K=!1;var L=!1;const M=x.JSAPIFilePath,N=x.JSAPIMonacoFilePath,O=x.ComponentAPIFilePath;module.exports={onConfigUpdate:function(b){if(!L)return void s({url:`${'https://dldir1.qq.com/WechatWebDev/preview/preview.json'}?r=${Date.now()}`},(b,c,d)=>{if(!b)try{d=JSON.parse(d);let b=a(d.last_ide);b&&k(d)}catch(a){w.error(`onConfigUpdate catch ${a}`)}});i(b.last_api);let c=j(b);c&&h(b.last_ide,c)},cleanApplicationCache:function(){return new Promise((a)=>{q('*',{cwd:y},(b,c)=>{c.forEach((a)=>{let b=o.join(y,a);l.unlinkSync(b)}),a()})})},checkNeedUpdate:j}}(require('lazyload'),require);